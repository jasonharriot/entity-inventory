<!DOCTYPE html>

<html>
	<head>
		<link rel="stylesheet" href="style/style.css" />
		<link rel="stylesheet" href="style/fields.css" />
		<link rel="stylesheet" href="style/edit.css" />
	</head>
	<body>
		<div id="container">
			<div id="header">
				<h1>Entity Inventory</h1>

				<h2><a class="backArrow" href="."><img src="img/arrow_left.png">Home</a></h2>
			</div>

			<div id="contentContainer">
				<div class="section">
					<form id="formEdit" action="">
						<h2>Entity ID <span class="fill" id="fillTagID"><i>loading...</i></span></h2>
						<table class="cardTable">
							<tbody>
								<tr class="rowEven">
									<td class="fieldCol">Entity type (sample, part, document, bag, etc.)</td>
									<td class="valueCol"><input type="text" class="fill" id="fillType" name="type"/></td>
								</tr>
								<tr class="rowOdd">
									<td class="fieldCol">Contents (chemical name)</td>
									<td class="valueCol"><input type="text" class="fill" id="fillContents" name="contents"/></td>
								</tr>
								<tr class="rowEven">
									<td class="fieldCol">Date (when this object was created/labeled)</td>
									<td class="valueCol"><input type="text" class="fill" id="fillDateSample" name="date_sample"/></td>
								</tr>
								<tr class="rowOdd">
									<td class="fieldCol">Initial mass of sample</td>
									<td class="valueCol"><input type="text" class="fill" id="fillMassInitial" name="mass_initial"/></td>
								</tr>
								<tr class="rowEven">
									<td class="fieldCol"><p>Parent ID(s)</p><p>What sample(s) is this sample derived from?</p></td>
									<td class="valueCol"><input type="text" class="fill" id="fillParentIDs" name="parent_ids"/></td>
								</tr>
								<tr class="rowOdd">
									<td class="fieldCol">Status (thrown away, consumed, lost, etc.)</td>
									<td class="valueCol"><input type="text" class="fill" id="fillStatus" name="status"/></td>
								</tr>
								<tr class="rowEven">
									<td class="fieldCol">Container size</td>
									<td class="valueCol"><input type="text" class="fill" id="fillContainerSize" name="container_size"/></td>
								</tr>
								<tr class="rowOdd">
									<td class="fieldCol">Physical form (liquid, solid, dust, chunks, paste, slime, gas, plasma, antimatter, etc.)</td>
									<td class="valueCol"><input type="text" class="fill" id="fillForm" name="form"/></td>
								</tr>
								<tr class="rowEven">
									<td class="fieldCol">Date of original experiment/batch</td>
									<td class="valueCol"><input type="text" class="fill" id="fillDateExperiment" name="date_experiment"/></td>
								</tr>
							</tbody>
						</table>
						
						<h3>Notes</h3>
						<div class="cardNotes">
							<textarea class="fill" id="fillNotes" name="notes">
							</textarea>
						</div>
						<p>
							<input type="button" id="buttonDiscard" value="Discard changes" />
							<input type="submit" id="buttonSave" target="_new" value="Save changes"/>
						</p>
					</form>
				</div>
			</div>

			<div id="footer">
				EDAC Labs, Inc.
			</div>
		</div>
		<script type="text/javascript" src="js/getCard.js"></script>
		<script type="text/javascript" src="js/showCard.js"></script>
		<script type="text/javascript" src="js/getTagID.js"></script>

		<script type="text/javascript">
			const buttonSaveElem = document.getElementById('buttonSave');

			const buttonDiscardElem = document.getElementById('buttonDiscard');

			const formEditElem = document.getElementById('formEdit');

			const tagID = getTagID();

			buttonDiscardElem.addEventListener('click', () => {
				if(confirm('Really discard changes?')){
					window.location.href = `viewcard.html?tagid=${tagID}`
				} 
			});

			getCard(tagID).then((card) => {
				showCard(card);

				formEditElem.setAttribute('action', `api/card/write/${tagID}`);
				//Tell the form to POST to the API endpoint which includes the
				//correct tag ID.

			}).catch( (e) => {
				console.error('Something went wrong:', e);
			});
		</script>
	</body>
</html>
